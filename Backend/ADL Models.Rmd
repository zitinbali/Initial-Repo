
```{r import, warning = FALSE, results= "hide", echo = FALSE}

source("GDP Cleaning.R")
source("inputs.R")
source("ADL Data.R")
source("AR_Model_Functions.R", local = TRUE)
source("ADL Functions.R")
source("ADL_Rolling.R")
source("DM_test.R")

```


# ADL Model - BAA-AAA Spread 

```{r adl model baa-aaa}

BAA_AAA_prediction <- ADL_predict_all(GDPGrowth_ts, baa_aaa_ts, example_fhorizon, covid_dummy)
ADL_predict_all(GDPGrowth_ts, baa_aaa_ts, 1, covid_dummy)
ADL_predict_all(GDPGrowth_ts, baa_aaa_ts, 2, covid_dummy)
ADL_predict_all(GDPGrowth_ts, baa_aaa_ts, 3, covid_dummy)
ADL_predict_all(GDPGrowth_ts, baa_aaa_ts, 4, covid_dummy)

```

# ADL Model - Treasury Spread 

```{r adl model treasury}

tspread_prediction <- ADL_predict_all(GDPGrowth_ts, tspread_ts, example_fhorizon, covid_dummy)
ADL_predict_all(GDPGrowth_ts, tspread_ts, 1, covid_dummy)
ADL_predict_all(GDPGrowth_ts, tspread_ts, 2, covid_dummy)
ADL_predict_all(GDPGrowth_ts, tspread_ts, 3, covid_dummy)
ADL_predict_all(GDPGrowth_ts, tspread_ts, 4, covid_dummy)

```




# ADL Model - FRED Hstarts

```{r adl model fred hstarts}

hstarts_prediction <- ADL_predict_all(GDPGrowth_ts, fred_hstarts_ts, example_fhorizon, covid_dummy)
ADL_predict_all(GDPGrowth_ts, fred_hstarts_ts, 1, covid_dummy)
ADL_predict_all(GDPGrowth_ts, fred_hstarts_ts, 2, covid_dummy)
ADL_predict_all(GDPGrowth_ts, fred_hstarts_ts, 3, covid_dummy)
ADL_predict_all(GDPGrowth_ts, fred_hstarts_ts, 4, covid_dummy)

```



# ADL Model - Consumer Sentiment

```{r adl model consent}

consent_prediction <- ADL_predict_all(GDPGrowth_ts, consent_ts, example_fhorizon, covid_dummy)
ADL_predict_all(GDPGrowth_ts, consent_ts, 1, covid_dummy)
ADL_predict_all(GDPGrowth_ts, consent_ts, 2, covid_dummy)
ADL_predict_all(GDPGrowth_ts, consent_ts, 3, covid_dummy)
ADL_predict_all(GDPGrowth_ts, consent_ts, 4, covid_dummy)

```

# ADL Model - NASDAQ Composite Index 

```{r adl model baa-aaa}

nasdaq_prediction <- ADL_predict_all(GDPGrowth_ts, nasdaq_ts, example_fhorizon, covid_dummy)
ADL_predict_all(GDPGrowth_ts, nasdaq_ts, 1, covid_dummy)
ADL_predict_all(GDPGrowth_ts, nasdaq_ts, 2, covid_dummy)
ADL_predict_all(GDPGrowth_ts, nasdaq_ts, 3, covid_dummy)
ADL_predict_all(GDPGrowth_ts, nasdaq_ts, 4, covid_dummy)

```

```{r rolling-window, warning = FALSE}

rw_baa = rolling_window_adl(perc_change_df_spliced, baa_aaa_ts, window_start, covid_dummy, real_values, example_startyq, example_endyq)
rw_tsp = rolling_window_adl(perc_change_df_spliced, tspread_ts, window_start, covid_dummy, real_values, example_startyq, example_endyq)
rw_hstarts = rolling_window_adl(perc_change_df_spliced, fred_hstarts_ts, window_start, covid_dummy, real_values, example_startyq, example_endyq)
rw_consent = rolling_window_adl(perc_change_df_spliced, consent_ts, window_start, covid_dummy, real_values, example_startyq, example_endyq)
rw_nasdaq = rolling_window_adl(perc_change_df_spliced, nasdaq_ts, window_start, covid_dummy, real_values, example_startyq, example_endyq)

```

```{r}

rw_baa$formula
rw_tsp$formula
rw_hstarts$formula
rw_consent$formula
rw_nasdaq$formula

pred2 = rw_nasdaq$pred

dm_test_result = dm_test(tail(real_values, window_length), pred1, pred2, window_start, example_endyq)[1]
# Basic vs Advanced values, Plots loss of basic - loss of advanced

p_value = pt(dm_test_result, df = window_length - 1) * 100

dm_test_result
p_value

```




