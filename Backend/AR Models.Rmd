
```{r import, warning = FALSE, results= "hide", echo = FALSE}

source("GDP Cleaning.R")
source("inputs.R")
source("DM_test.R")
source("AR_Model_Functions.R")

```

### Basic AR Model 

```{r AR Model 1}

# Creating a test dataset that comprises the growth_rate from the check dataset

start_rownum = which(grepl(example_startyq, check$Time))
end_rownum = which(grepl(example_endyq, check$Time))

basic_AR_input <- check[start_rownum:end_rownum, ] %>% 
  select(growth_rate) %>% 
  as.matrix()

h = example_fhorizon

basic_AR_output <- fitAR(basic_AR_input, example_fhorizon, covid_dummy)

ar1_prediction = basic_AR_output$pred
ar1_rmsfe = basic_AR_output$rmsfe

```

### Advanced AR Model 

```{r Advanced AR model, warning = FALSE}

advanced_AR_input = adv_ar_input(RGDP_Data, example_startq, example_endq)


advanced_AR_output <- fitAR(advanced_AR_input, example_fhorizon, covid_dummy)

ar2_prediction = advanced_AR_output$pred
ar2_rmsfe = advanced_AR_output$rmsfe

```

### DM Test

```{r DM Test, warning = FALSE}

row_start_slice = (example_startyq - as.yearqtr("1947 Q2"))*4 + 1
row_last_slice = nrow(check) - (as.yearqtr("2023 Q4") - example_endyq)*4

real_values = as.matrix(check[row_start_slice:row_last_slice, ncol(check)])
start = example_endyq - 50/4
end = example_endyq

pred1 = rolling_window(basic_AR_input, 50, covid_dummy, real_values, start, end)$pred
pred2 = rolling_window(advanced_AR_input, 50, covid_dummy, real_values, start, end)$pred

dm_test(tail(real_values, 50), pred1, pred2, start, end)
# Basic vs Advanced values, Plots loss of basic - loss of advanced

```